# コマンドラインツール

candy-pi-lite サービスをインストールすると、`candy`コマンドをターミナルから利用することができます。
このコマンドを使うと以下の機能を利用することができます。ただし、APN設定については、`candy`コマンドを利用しても設定は反映されません。[APN設定](/configuration/apn.md)のページをご覧になり、そちらに記載の方法でAPNを設定してください。

  * [SIMカード認識状態の表示](sim.md)
  * [ネットワーク状態の表示](network.md)
  * [通信モジュール情報の表示](modem.md)
  * [GNSSの制御](gnss.md)
  * [モバイルネットワーク接続の制御](connection.md)

## コマンドラインご利用上の注意

`candy`コマンドを実行するには、candy-pi-lite サービスが動作していなければなりません。動作していない場合は、以下のようなエラーメッセージが表示されます。

```
[ERROR] CANDY Board Service isn't running
```

このような場合は、[candy-pi-lite サービスの起動](/service/start.md)をおこなってください。すでに起動処理が進行している時は、完了までリトライするようにしてください。

また、CANDY Pi Liteが携帯電話ネットワークに接続されている場合は、次のようなメッセージが出ることがあります。

```
"Modem is not ready"
```

これは、コマンドラインツールと通信モジュールとの間のシリアル通信が、携帯電話ネットワークへのIP通信と同一経路を利用しているため、携帯電話ネットワークへのIP通信を行っている最中には`candy`コマンドの実行を行うことができないということによるエラーメッセージです。この場合は、`-s -r`と言う接続の一時停止と復旧のオプションをつけてコマンドを実行することによりスムーズにコマンドを実行しつつ接続状態を維持することが可能です。

## プログラムから使用する場合について

### コマンド実行結果文字列

`candy`コマンドをプログラムから使用すると結果文字列に文字色をつけるエスケープシーケンスが入った文字列で返ってきます。これを防ぐには`NO_COLOR=1`の環境変数を実行プロセスに渡すようにしてください。

### 接続状態を調べるには

`candy`コマンドを利用すると接続状態を確認することができます。これを利用して、プログラム上で接続状態がオンラインになってから次の処理を行うなどの動きを実現可能です。
注意点としては、

1. 接続状態確認には`candy connection status`を使用すること（`-r -s`のオプションは常に不要です）。
1. 結果コードが`0`以外の場合は、時間を置いてリトライすること（サービスが起動中の場合は結果コードが0以外のコードになります）。
1. `NO_COLOR=1`の環境変数をつけてコマンドを実行すること（前述の通り、プログラム処理にとっては余計な文字列を排除するためのものです）。
1. `candy`コマンドは特権ユーザーで実行すること。

判定方法は、以下の通りです。`NO_COLOR=1`の環境変数をつけていない場合、文字列一致ができませんのでご注意ください。
- 結果の文字列が`OFFLINE`または結果コードが0以外の場合は、接続できていません。
- 結果の文字列が`ONLINE`の場合は、接続できています。
- 結果コードが0以外の場合、文字列には`[ERROR] CANDY Board Service isn't running`が入ります。

